"use strict";(self.webpackChunkhire_tracker_app=self.webpackChunkhire_tracker_app||[]).push([[20],{7020:(N,_,c)=>{c.r(_),c.d(_,{AdminModule:()=>o});var y=c(6895),p=c(9132),e=c(4650);let f=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-admin"]],decls:2,vars:0,template:function(r,i){1&r&&(e.TgZ(0,"p"),e._uU(1,"admin works!"),e.qZA())}}),t})();var g=c(2924),D=c(73),v=c(8382),h=c(3546),T=c(4859),S=c(8683);let k=(()=>{class t{constructor(r,i){this.dbService=r,this.notify=i,this.updateTimestampEvent=new e.vpe,this.columnDefs=[{headerName:"#",valueGetter:"node.rowIndex + 1",width:80,checkboxSelection:!0,headerCheckboxSelection:!0},{headerName:" Name",field:"username",sortable:!0,filter:!0},{headerName:"Phone",field:"phone",sortable:!0,filter:!0},{headerName:"Region",field:"regionId",sortable:!0,filter:!0},{headerName:"Active",field:"active",sortable:!0,filter:!0}],this.baseUrl="admin/users",this.url="admin/users",this.ts="",this.getActions=l=>{const a=[];return null!==l.status?a.push({label:"Activate Account",type:"button",onClick:u=>this.activate(u)}):a.push({label:"Edit",type:"link",link:"admin/userForm/",linkProp:"id"},{label:"Deactivate Account",type:"button",onClick:u=>this.deactivate(u)}),a},this.updateTimestampEvent.subscribe(()=>{this.updateTimestamp()})}updateTimestamp(){this.ts=(0,g.x2)("timestamp_string")}setSelectedItems(r){}deactivate(r){const i=window.prompt("Please state a reason for deactivating this user");this.dbService.put(`admin/users/${r.id}/deactivate`,i?{reason:i}:{}).subscribe({next:a=>{this.notify.successNotification(a.message),this.updateTimestamp()},error:a=>{}})}deleteUser(r){!window.confirm("Are you sure you want to deactivate this user? This will prevent the account from being used until you re-activate it")||this.dbService.delete("admin/users/"+r.id).subscribe({next:i=>{this.notify.successNotification(i.message),this.updateTimestamp()},error:i=>{}})}activate(r){!window.confirm("Are you sure you want to activate this user? This will allow the user to login to the system")||this.dbService.put("admin/users/"+r.id+"/activate",{active:1}).subscribe({next:i=>{this.notify.successNotification(i.message),this.updateTimestamp()},error:i=>{}})}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(D.O),e.Y36(v.c))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-users"]],decls:6,vars:3,consts:[[1,"flex","flex-col","gap-1"],["mat-raised-button","","color","primary","routerLink","/admin/userForm"],[3,"timestamp","url","getActions","onSelect","selectionChanged"]],template:function(r,i){1&r&&(e.TgZ(0,"div",0)(1,"a",1),e._uU(2,"Add a new user"),e.qZA(),e.TgZ(3,"mat-card")(4,"mat-card-content")(5,"app-load-data-list",2),e.NdJ("onSelect",function(a){return i.setSelectedItems(a)})("selectionChanged",function(a){return i.setSelectedItems(a)}),e.qZA()()()()),2&r&&(e.xp6(5),e.Q6J("timestamp",i.ts)("url",i.url)("getActions",i.getActions))},dependencies:[p.rH,h.a8,h.dn,T.zs,S.f]}),t})();c(6841);var F=c(7057);let U=(()=>{class t{constructor(r,i){this.router=i,this.title="Add a new user",this.formUrl="admin/users",this.existingUrl="admin/users",this.fields=[{label:"Username",name:"username",hint:"the name of the user",options:[],type:"text",value:"",required:!0},{label:"Password",name:"password",hint:"",options:[],type:"password",value:"",required:!0,api_url:"",apiKeyProperty:"",apiLabelProperty:"",minLength:8},{label:"Confirm Password",name:"password_confirm",hint:"",options:[],type:"password",value:"",required:!0,api_url:"",apiKeyProperty:"",apiLabelProperty:"",minLength:8,customValidation:{fieldsMatch:["password"]}},{label:"Phone number",name:"phone",hint:"the phone number of the user. May be used for 2-factor authentication",options:[],type:"text",value:"",required:!0},{label:"Email address",name:"email",hint:"the email address of the user. May be used for 2-factor authentication",options:[],type:"email",value:"",required:!0},{label:"Picture",name:"picture",hint:"",options:[],type:"text",value:"",required:!1},{label:"Position",name:"position",hint:"The user's position in the institution",options:[],type:"text",value:"",required:!1},{label:"Role",name:"role_id",hint:"",options:[],type:"api",value:"",required:!0,api_url:"admin/roles",apiKeyProperty:"role_id",apiLabelProperty:"role_name",apiType:"select"}],this.fieldsTemplate="TrainingInstitutionFormTemplate",this.id=r.snapshot.params.id,this.id&&(this.title="Edit user",this.existingUrl=`admin/users/${this.id}`,this.formUrl=`admin/users/${this.id}`,this.fields.map(l=>{"password"===l.name&&(l.required=!1,l.hint="Leave it blank if you don't intend to change this user's password. Else you can enter a new password"),"password_confirm"===l.name&&(l.required=!1)}))}ngOnInit(){}formSubmitted(r){r&&this.router.navigate(["/admin/users"])}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(p.gz),e.Y36(p.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-form"]],decls:3,vars:4,consts:[[3,"url","fields","existingObjectUrl","id","onSubmit"]],template:function(r,i){1&r&&(e.TgZ(0,"mat-card")(1,"mat-card-content")(2,"app-form-generator",0),e.NdJ("onSubmit",function(a){return i.formSubmitted(a)}),e.qZA()()()),2&r&&(e.xp6(2),e.Q6J("url",i.formUrl)("fields",i.fields)("existingObjectUrl",i.existingUrl)("id",i.id))},dependencies:[h.a8,h.dn,F.C]}),t})(),b=(()=>{class t{constructor(r,i){this.dbService=r,this.notify=i,this.baseUrl="admin/roles",this.url="admin/roles",this.ts="",this.getActions=l=>{const a=[];return null!==l.deleted_at?a.push({label:"Activate",type:"button",onClick:u=>this.activate(u)}):a.push({label:"Edit details",type:"link",link:"admin/role-form/",linkProp:"role_id"},{label:"Edit permissions",type:"link",link:"admin/role-permissions/",linkProp:"role_id"},{label:"Deactivate",type:"button",onClick:u=>this.deleteRole(u)}),a}}activate(r){!window.confirm("Are you sure you want to re-activate this role?")||this.dbService.put("admin/roles/"+r.role_id+"/restore",{}).subscribe({next:i=>{this.notify.successNotification(i.message),this.updateTimestamp()},error:i=>{}})}deleteRole(r){!window.confirm("Are you sure you want to deactivate this role? This will prevent the role from receiving new users, but will not affect existing users. You will be able to restore it")||this.dbService.delete("admin/roles/"+r.role_id).subscribe({next:i=>{this.notify.successNotification(i.message),this.updateTimestamp()},error:i=>{}})}updateTimestamp(){this.ts=(0,g.x2)("timestamp_string")}setSelectedItems(r){}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(D.O),e.Y36(v.c))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-roles"]],decls:6,vars:3,consts:[[1,"flex","flex-col","gap-1"],["mat-raised-button","","color","primary","routerLink","/admin/role-form"],[3,"timestamp","url","getActions","onSelect","selectionChanged"]],template:function(r,i){1&r&&(e.TgZ(0,"div",0)(1,"a",1),e._uU(2,"Add a new role"),e.qZA(),e.TgZ(3,"mat-card")(4,"mat-card-content")(5,"app-load-data-list",2),e.NdJ("onSelect",function(a){return i.setSelectedItems(a)})("selectionChanged",function(a){return i.setSelectedItems(a)}),e.qZA()()()()),2&r&&(e.xp6(5),e.Q6J("timestamp",i.ts)("url",i.url)("getActions",i.getActions))},dependencies:[p.rH,h.a8,h.dn,T.zs,S.f]}),t})(),A=(()=>{class t{constructor(r,i){this.router=i,this.title="Add a new role",this.formUrl="admin/roles",this.existingUrl="admin/roles",this.fields=[{label:"Role name",name:"role_name",hint:"the name of the role",options:[],type:"text",value:"",required:!0},{label:"Description",name:"description",hint:"",options:[],type:"textarea",value:"",required:!0,api_url:"",apiKeyProperty:"",apiLabelProperty:""}],this.id=r.snapshot.params.id,this.id&&(this.title="Edit role",this.existingUrl=`admin/roles/${this.id}`,this.formUrl=`admin/roles/${this.id}`)}ngOnInit(){}formSubmitted(r){r&&this.router.navigate(["/admin/roles"])}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(p.gz),e.Y36(p.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-role-form"]],decls:3,vars:4,consts:[[3,"url","fields","existingObjectUrl","id","onSubmit"]],template:function(r,i){1&r&&(e.TgZ(0,"mat-card")(1,"mat-card-content")(2,"app-form-generator",0),e.NdJ("onSubmit",function(a){return i.formSubmitted(a)}),e.qZA()()()),2&r&&(e.xp6(2),e.Q6J("url",i.formUrl)("fields",i.fields)("existingObjectUrl",i.existingUrl)("id",i.id))},dependencies:[h.a8,h.dn,F.C]}),t})();var P=c(7392),w=c(4633);function m(t,s){if(1&t){const r=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){const a=e.CHM(r).$implicit,u=e.oxw();return e.KtG(u.removePermission(a))}),e.TgZ(1,"span",5),e._uU(2),e.qZA(),e.TgZ(3,"span",6),e._uU(4),e.qZA()()}if(2&t){const r=s.$implicit;e.xp6(2),e.Oqu(r.name),e.xp6(2),e.Oqu(r.description)}}function Z(t,s){if(1&t){const r=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){const a=e.CHM(r).$implicit,u=e.oxw();return e.KtG(u.addPermission(a))}),e.TgZ(1,"span",5),e._uU(2),e.qZA(),e.TgZ(3,"span",6),e._uU(4),e.qZA()()}if(2&t){const r=s.$implicit;e.xp6(2),e.Oqu(r.name),e.xp6(2),e.Oqu(r.description)}}const M=[{path:"",component:f},{path:"users",data:{title:"System Users"},component:k},{path:"userForm",data:{title:"Add a new user"},component:U},{path:"userForm/:id",data:{title:"Edit user"},component:U},{path:"roles",data:{title:"User Roles"},component:b},{path:"role-form",data:{title:"Add a new role"},component:A},{path:"role-form/:id",data:{title:"Edit role details"},component:A},{path:"role-permissions/:id",data:{title:"Edit role permissions"},component:(()=>{class t{constructor(r,i,l,a){this.router=i,this.dbService=l,this.notify=a,this.permissions=[],this.excludedPermissions=[],this.id=r.snapshot.params.id,this.id||(alert("No role identified"),this.router.navigate(["/admin/roles"]))}ngOnInit(){this.getData()}getData(){this.notify.showLoading(),this.dbService.get(`admin/roles/${this.id}`).subscribe({next:r=>{this.role=r.data,this.permissions=r.permissions,this.excludedPermissions=r.excludedPermissions,this.notify.hideLoading()},error:r=>{this.notify.failNotification("Error loading data. Please try again")}})}addPermission(r){var i;if(!window.confirm(`Grant ${r.name} to ${null===(i=this.role)||void 0===i?void 0:i.role_name}?`))return;this.notify.showLoading();const l=new FormData;l.append("role_id",this.role.role_id),l.append("permission_id",r.permission_id),this.dbService.post("admin/rolePermissions",l).subscribe({next:a=>{this.getData(),this.notify.successNotification(a.message),this.notify.hideLoading()},error:a=>{}})}removePermission(r){var i;if(!window.confirm(`Remove ${r.name} from ${null===(i=this.role)||void 0===i?void 0:i.role_name}?`))return;this.notify.showLoading();const l=new FormData;l.append("role_id",this.role.role_id),l.append("permission_id",r.permission_id),this.dbService.delete(`admin/rolePermissions/${this.role.role_id}/${r.permission_id}`).subscribe({next:a=>{this.getData(),this.notify.successNotification(a.message),this.notify.hideLoading()},error:a=>{}})}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(p.gz),e.Y36(p.F0),e.Y36(D.O),e.Y36(v.c))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-role-permissions"]],decls:30,vars:6,consts:[["mat-raised-button","","color","primary",3,"click"],[1,"row"],[1,"col-6"],["mat-list-item","",3,"click",4,"ngFor","ngForOf"],["mat-list-item","",3,"click"],["matListItemTitle",""],["matListItemLine",""]],template:function(r,i){1&r&&(e.TgZ(0,"div")(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"em"),e._uU(4),e.qZA(),e.TgZ(5,"button",0),e.NdJ("click",function(){return i.getData()}),e.TgZ(6,"mat-icon"),e._uU(7,"refresh"),e.qZA(),e._uU(8," Refresh"),e.qZA()(),e.TgZ(9,"div",1)(10,"div",2)(11,"mat-card")(12,"mat-card-header")(13,"mat-card-title"),e._uU(14),e.qZA(),e.TgZ(15,"mat-card-subtitle"),e._uU(16,"Click on a permission in the list if you want to remove it from this role"),e.qZA()(),e.TgZ(17,"mat-card-content")(18,"mat-action-list"),e.YNc(19,m,5,2,"button",3),e.qZA()()()(),e.TgZ(20,"div",2)(21,"mat-card")(22,"mat-card-header")(23,"mat-card-title"),e._uU(24),e.qZA(),e.TgZ(25,"mat-card-subtitle"),e._uU(26,"Click on a permission in the list if you want to add it to this role"),e.qZA()(),e.TgZ(27,"mat-card-content")(28,"mat-action-list"),e.YNc(29,Z,5,2,"button",3),e.qZA()()()()()),2&r&&(e.xp6(2),e.Oqu(null==i.role?null:i.role.role_name),e.xp6(2),e.Oqu(null==i.role?null:i.role.description),e.xp6(10),e.hij("Current Permissions(",i.permissions.length,") "),e.xp6(5),e.Q6J("ngForOf",i.permissions),e.xp6(5),e.hij("Excluded Permissions(",i.excludedPermissions.length,") "),e.xp6(5),e.Q6J("ngForOf",i.excludedPermissions))},dependencies:[y.sg,h.a8,h.dn,h.dk,h.$j,h.n5,P.Hw,T.lW,w.lT,w.Tg,w.WW,w.sL]}),t})()}];let x=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[p.Bz.forChild(M),p.Bz]}),t})();var n=c(7410);let o=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[y.ez,x,n.m]}),t})()},2924:(N,_,c)=>{function f(n="",o=null){let t=new Date;null!=o&&(t=new Date(o));let l,a,s=t.getDate(),r=t.getMonth()+1,i=t.getFullYear();l=s<10?"0"+s:s.toString(),a=r<10?"0"+r:r.toString();let u="",d="",C="";switch(n){case"timestamp":return u=g(t.getHours()),d=g(t.getMinutes()),C=g(t.getSeconds()),i+"-"+a+"-"+l+" "+u+":"+d+":"+C;case"timestamp_string":return u=g(t.getHours()),d=g(t.getMinutes()),C=g(t.getSeconds()),i+""+a+l+u+d+C;case"month":return a;case"year":return i.toString();default:return i+"-"+a+"-"+l}}function g(n){return n.toString().padStart(2,"0")}c.d(_,{x2:()=>f})}}]);